{% extends 'layout.html' %}

{% block seris_content %}

<script type="text/javascript">
$(document).ready(function() {
    $('#delete_report').click(function() {
        $( "#dialog-delete-confirm" ).dialog({
            open: function() {
                $(this).siblings(".ui-dialog-buttonpane").find("button:eq(1)").focus();
            },
            resizable: false,
            height: 200,
            width: 500,
            modal: true,
            draggable: false,
            buttons: {
                "Delete report": function() {
                    var form = $('#fdelete_report');
                    return form.submit();
                },
                "Cancel": function() {
                    $( this ).dialog( "close" );
                }
            }
        });
    });
})
</script>

<div class="report-content">
    <div class="report-actions">
        [<a href="{{url_for('views.report_list')}}">
            Back to reports list
        </a>]
        [<a href="{{url_for('views.report_edit',
            report_id=report['id'])}}">
            Edit Report
        </a>]
        [<a id="delete_report" href="javascript:void(0);">
            Delete Report
        </a>]
</div>
<div id="dialog-delete-confirm" title="Delete report" style="display: none">
    <p>
        <span class="ui-icon ui-icon-alert" style="float:left; margin:0 7px 20px 0;"></span>
        This report will be permanently deleted and cannot be recovered. Are you sure?
    </p>
    <form id="fdelete_report" action="{{url_for('views.report_delete', report_id=report['id'])}}" method="POST"></form>
</div>
    <hr/>

    {% set cover = report['data']['header']['soer_cover'] %}
    {% if (not cover.is_empty) %}
      {% set url = url_for('views.download', db_id=cover.u) %}
      <img src="{{ url }}" class="report-header_soer_cover" width="120" height="160">
    {% endif %}

    <h1>{{ ', '.join(report['data']['header']['country'].value) }}</h1>
    <h2>{{ report['data']['details']['english_name'].value or
           report['data']['details']['original_name'].value }}</h2>

    <p class="report-header_upload_date">
      This fact-sheet was prepared on:
      <strong>{{ report['data']['header']['upload_date'] }}</strong>
    </p>

    <p class="report-header_uploader">
      Prepared by:
      <strong>{{ report['data']['header']['uploader'] }}</strong>
    </p>

    <p class="report-format-paper-or-url">
      {% if report['data']['format']['availability']['paper_or_web'].value == 'web'
        and report['data']['format']['availability']['url'] %}
        <strong>This fact-sheet is accessible at</strong>:
        {{ mk.widget(report['data']['format']['availability']['url']) }}
      {% elif report['data']['format']['availability']['paper_or_web'].value == 'paper only'%}
        <strong>This fact-sheet is available only on paper</strong>
      {% endif %}
    </p>

    {{ mk.widget(report['data']) }}
    {% if report['seris_reviews'] %}
        {{ mk.widget(report['seris_reviews'][0]['data']) }}
    {% endif %}
</div>

{% endblock %}

{% block scripts %}
    {{ script_src("js/main.js") }}
{% endblock %}
