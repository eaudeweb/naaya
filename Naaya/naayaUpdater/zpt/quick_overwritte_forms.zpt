<tal:block metal:use-macro="here/standard_template.pt/macros/page">
	<tal:block metal:fill-slot="head">
		<title>Quick update Naaya forms</title>
		<script type="text/javascript">
		<!--
		function fOpen(diff_form)
		{
			var wnd = window.open(diff_form);
			wnd.focus();
		}
		// -->
		</script>
	</tal:block>

	<tal:block metal:fill-slot="body">

	<div>
		<a tal:attributes="href string:${here/absolute_url}" title="Back to index">Back to index</a>
		<br /><br />
	</div>

	<tal:block define="forms python:request.get('forms', '');
						portals python:request.get('portals', '');
						p_action python:request.get('p_action', 'ep');
						upload_ok python:request.get('u', 0);
						report python:here.getReportQuickModifiedForms(forms, portals, p_action, request)">

	<fieldset>
		<legend>Quick update Naaya forms</legend>
		<p>Quick update Naaya forms.</p>
		<form method="post" name="frmQuickModForms">

			<label for="exclude">Forms</label><br />
			<textarea name="forms" id="forms" cols="50" rows="5" tal:content="forms"></textarea>
			<small>*one ID on a row</small>
			<br />

			<label for="portals">Portal(s) IDs list</label><br />
			<textarea name="portals" id="portals" cols="50" rows="5" tal:content="portals"></textarea>
			<small>*separate portal ids by commas</small><br />
			<input type="radio" name="p_action" value="ep" tal:attributes="checked python:test(p_action=='ep','checked','')" />
			<span>exclude</span>
			<input type="radio" name="p_action" value="ip" tal:attributes="checked python:test(p_action=='ip','checked','')" />
			<span>update only</span>
			<br />

			<input type="submit" name="show_report" value="Show report" />
		</form>
	</fieldset>

	<h2 tal:condition="report">Report</h2>

	<div tal:condition="report">
		<form tal:attributes="action string:${here/absolute_url}/reloadQuickPortalForms"
			  method="post" name="frmQuickReloadForms">
			<input type="checkbox" name="all" />
			<label for="all">Update all forms</label>

			<tal:block condition="python:report.items()[0][0] != 'all'">
			<tal:block repeat="portal_report python:report.items()">
			<div tal:define="portal_path python:portal_report[0];
							 portal python:here.getPortal(portal_path);
							 report python:portal_report[1]">

				<h3>
					<span tal:content="portal/title_or_id" />
					(<small>meta-type:<span tal:content="portal/meta_type" />, path:<span tal:content="portal_path" />)
				</h3>

				<ul>
					<li tal:repeat="rep report">
						<tal:block define="action_type python:rep[1];
											fmod python:rep[0]">
							<tal:block condition="python:action_type=='edit'">
								<tal:block define="fpath python:fmod.absolute_url(1)">
								<input type="checkbox" name="fmod" tal:attributes="value fpath" />
								<a tal:attributes="id fpath" />
								[<a tal:attributes="onclick string:javascript:fOpen('${here/absolute_url}/diff_forms_html?f=${fmod/id}&fpath=${fpath}&p=${portal_path}'); href string:#${fpath}">see diff</a>]&nbsp;
								<a tal:attributes="href string:${fmod/absolute_url}/pt_editForm; title fmod/title_or_id" tal:content="fmod/id" target="new" />
								</tal:block>
							</tal:block>
							<tal:block condition="python:action_type=='add'">
								<input type="checkbox" name="fmod" tal:attributes="value python:here.generateFormPath(fmod, portal)" />
								<em tal:content="fmod" /> missing from ZMI (form will be added)
							</tal:block>
						</tal:block>
					</li>
				</ul>

			</div>
			</tal:block>
			</tal:block>

			<br /><br />
			<input type="hidden" name="forms" id="forms" tal:attributes="value forms" />
			<input type="submit" name="reload" value="Reload" />
		</form>
	</div>

	</tal:block>
	</tal:block>
</tal:block>